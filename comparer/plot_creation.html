<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Galen Holt">

<title>Using the WERP toolkit - Plot demonstrations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Using the WERP toolkit</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../scenario_creation/scenario_creation_overview.html">
 <span class="menu-text">Scenario creation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../causal_networks/causal_overview.html">
 <span class="menu-text">Causal networks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../controller/controller_overview.html">
 <span class="menu-text">Controller</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../aggregator/aggregation_overview.html">
 <span class="menu-text">Aggregator</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../comparer/comparer_overview.html">
 <span class="menu-text">Comparer</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../full_toolkit/full_toolkit_overview.html">
 <span class="menu-text">Full toolkit</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MDBAuth/WERP_toolkit_demo"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#notebook-to-develop-plots" id="toc-notebook-to-develop-plots" class="nav-link active" data-scroll-target="#notebook-to-develop-plots">Notebook to develop plots</a>
  <ul class="collapse">
  <li><a href="#scenario-information" id="toc-scenario-information" class="nav-link" data-scroll-target="#scenario-information">Scenario information</a></li>
  </ul></li>
  <li><a href="#descriptive" id="toc-descriptive" class="nav-link" data-scroll-target="#descriptive">Descriptive</a>
  <ul class="collapse">
  <li><a href="#hydrographs" id="toc-hydrographs" class="nav-link" data-scroll-target="#hydrographs">Hydrographs</a>
  <ul class="collapse">
  <li><a href="#make-that-a-function" id="toc-make-that-a-function" class="nav-link" data-scroll-target="#make-that-a-function">Make that a function</a></li>
  <li><a href="#what-else-might-we-want-to-do" id="toc-what-else-might-we-want-to-do" class="nav-link" data-scroll-target="#what-else-might-we-want-to-do">What else might we want to do?</a></li>
  </ul></li>
  <li><a href="#setting-baseline" id="toc-setting-baseline" class="nav-link" data-scroll-target="#setting-baseline">Setting baseline</a></li>
  <li><a href="#describing-the-aggregation" id="toc-describing-the-aggregation" class="nav-link" data-scroll-target="#describing-the-aggregation">Describing the aggregation</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#davids-heatmap" id="toc-davids-heatmap" class="nav-link" data-scroll-target="#davids-heatmap">David’s heatmap</a></li>
  <li><a href="#scenario-vs-outcome-1d" id="toc-scenario-vs-outcome-1d" class="nav-link" data-scroll-target="#scenario-vs-outcome-1d">Scenario vs outcome 1d</a>
  <ul class="collapse">
  <li><a href="#bar" id="toc-bar" class="nav-link" data-scroll-target="#bar">Bar</a></li>
  <li><a href="#same-thing-but-better-data" id="toc-same-thing-but-better-data" class="nav-link" data-scroll-target="#same-thing-but-better-data">Same thing, but better data</a></li>
  <li><a href="#stacked-bar-multiple-outcomes" id="toc-stacked-bar-multiple-outcomes" class="nav-link" data-scroll-target="#stacked-bar-multiple-outcomes">Stacked bar, multiple outcomes</a></li>
  <li><a href="#scenario-colors" id="toc-scenario-colors" class="nav-link" data-scroll-target="#scenario-colors">scenario colors</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#lines-with-quant-x" id="toc-lines-with-quant-x" class="nav-link" data-scroll-target="#lines-with-quant-x">Lines with quant x</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#maps" id="toc-maps" class="nav-link" data-scroll-target="#maps">Maps</a></li>
  <li><a href="#aggsequencing" id="toc-aggsequencing" class="nav-link" data-scroll-target="#aggsequencing">Aggsequencing</a></li>
  <li><a href="#tiles" id="toc-tiles" class="nav-link" data-scroll-target="#tiles">Tiles</a></li>
  <li><a href="#causal-networks" id="toc-causal-networks" class="nav-link" data-scroll-target="#causal-networks">Causal networks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Plot demonstrations</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Galen Holt </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="notebook-to-develop-plots" class="level2">
<h2 class="anchored" data-anchor-id="notebook-to-develop-plots">Notebook to develop plots</h2>
<p>Then send them to the werptoolkitr package. They’re just easier to develop here where there’s data to plot.</p>
<p>What’s the best way to do this though? just <code>devtools::load_all(path/to/toolkit)</code> for quick dev, anyway, I think.</p>
<p>Largely the same header junk as the other qmds here to allow me to load the toolkit different ways.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-1_134a216b9e7e0ecc993bc4ebb0fe2ca6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## GITHUB INSTALL</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># credentials::set_github_pat()</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("MDBAuth/WERP_toolkit", ref = 'packaging', subdir = 'werptoolkitr', force = TRUE)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## LOCAL INSTALL- easier for quick iterations, but need a path.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_local("C:/Users/galen/Documents/WERP_toolkit/werptoolkitr", force = TRUE)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># And for very fast iteration (no building, but exposes too much, often)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"C:/Users/galen/Documents/WERP_toolkit/werptoolkitr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-2_9bb7a6d17ab9cbcfafddd3c9d54a694e">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(werptoolkitr)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># make my life easier</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:testthat':

    matches</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-3_176b580481aaf92fcbe220a43f882863">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>scenario_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">'scenario_example'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ewr_results <span class="ot">&lt;-</span> <span class="fu">file.path</span>(scenario_dir, <span class="st">'module_output'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>geo_data_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="at">package =</span> <span class="st">'werptoolkitr'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="scenario-information" class="level3">
<h3 class="anchored" data-anchor-id="scenario-information">Scenario information</h3>
<p>This needs to come from somewhere. For now, I’m just using it for diagnostic plots, so make it here.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-4_26b3b02de22e6383b0eba90ec5603556">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">scenario =</span> <span class="fu">c</span>(<span class="st">'base'</span>, <span class="st">'down4'</span>, <span class="st">'up4'</span>), <span class="at">delta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.25</span>, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I think I probably want to make a standard ordering of the scenarios. Can I push something through to plots</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-5_ffe02f798e5301367e59b9e82170919d">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sceneorder <span class="ot">&lt;-</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(scenarios<span class="sc">$</span>scenario, scenarios<span class="sc">$</span>delta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="descriptive" class="level1">
<h1>Descriptive</h1>
<section id="hydrographs" class="level2">
<h2 class="anchored" data-anchor-id="hydrographs">Hydrographs</h2>
<p>Settings</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-6_567f1445a91c107e2330ac9e99c2f78d">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>hydropath <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">'scenario_example'</span>, <span class="st">'hydrographs'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is code to unpack that, but it’s in python and sends them to the EWR, but here we just want to read them in. Here, make something that we can also change. With a wrapper that lets me read different hydrograph formats.</p>
<p><code>mdba_gauge_getter</code> seems to default to flow, and gets them with <code>141</code>, ML/day. Check that all makes sense- what does EWR use? It is ML/day for most gauges (which is <code>varto = 141</code>), though some are stage gauges and use 100.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-7_1ddab8e9a49dfb04208eff1102d7fac8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read_hydro &lt;- function(hydropath, long = TRUE, format = 'csv') {</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (format == 'csv') {</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(read_hydro_csv(hydropath, long))</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   }  </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># read_hydro_csv &lt;- function(hydropath, long) {</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   all_hydros &lt;- list.files(hydropath, recursive = TRUE)</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   # read-in and extract the names</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   hydros &lt;- readr::read_csv(file.path(hydropath, all_hydros), id = 'scenario') |&gt; </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     dplyr::mutate(scenario = stringr::str_extract(scenario, "(\\w|\\d)+\\.csv$"),</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#            scenario = stringr::str_extract(scenario, '^[\\w|\\d]+'))</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (long) {</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     hydros &lt;- tidyr::pivot_longer(hydros, cols = -c(scenario, Date), names_to = "gauge", values_to = "flow")</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(hydros)</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, make a plot. How do we want to organise it? There are lots of options. Particularly subsetting gauges.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-8_acd2e07d3e2540725f884f608c877b8e">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>scenehydros <span class="ot">&lt;-</span> <span class="fu">read_hydro</span>(hydropath, <span class="at">long =</span> <span class="cn">TRUE</span>, <span class="at">format =</span> <span class="st">'csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-9_42cd48e48140bc70fb10d76060b73596">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>gauges_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'412002'</span>, <span class="st">'419001'</span>, <span class="st">'422028'</span>, <span class="st">'421001'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>forcats::fct_reorder(scenario, flow, .fun=median)</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-10_16bdaf3d8420fa0a16f5706b6a7fba3a">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>scenehydros <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(gauge <span class="sc">%in%</span> gauges_to_plot) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> flow, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(scenario, <span class="fu">levels</span>(sceneorder)))) <span class="sc">+</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>gauge) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_werp_toolkit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="make-that-a-function" class="level3">
<h3 class="anchored" data-anchor-id="make-that-a-function">Make that a function</h3>
<p>Moved it to the package</p>
<p>A typical plot</p>
<p>First, let’s establish a standard set of colours with base as a reference</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-11_76cdb9fb8665c39dfd6ce2064006acc0">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rcartocolor::Antique</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RColorBrewer::Set2</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>scene_pal <span class="ot">&lt;-</span> <span class="fu">make_pal</span>(<span class="fu">unique</span>(scenehydros<span class="sc">$</span>scenario), <span class="at">palette =</span> <span class="st">'ggsci::nrc_npg'</span>, <span class="at">refvals =</span> <span class="st">'base'</span>, <span class="at">refcols =</span> <span class="st">'black'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>scene_pal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;colors&gt;
black #E64B35FF #4DBBD5FF </code></pre>
</div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-12_23dae8e7c2b80c2bc20d5ce5efc7ffe2">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hydrographs</span>(scenehydros, <span class="at">gaugefilter =</span> gauges_to_plot, <span class="at">colors =</span> scene_pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A test with scenariofilter, scales, and trans. Kinda silly, but shows it works</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-13_abf15adbf12d315aa0a5d5ad8c555f5b">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hydrographs</span>(scenehydros, <span class="at">gaugefilter =</span> gauges_to_plot, <span class="at">scenariofilter =</span> <span class="fu">c</span>(<span class="st">'up4'</span>, <span class="st">'down4'</span>), <span class="at">scales =</span> <span class="st">'free_y'</span>, <span class="at">transy =</span> <span class="st">'log10'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>colors not specified per level. Trying to use the 'colors' argument as a palette
name</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="what-else-might-we-want-to-do" class="level3">
<h3 class="anchored" data-anchor-id="what-else-might-we-want-to-do">What else might we want to do?</h3>
<ul>
<li><p>select scenarios</p></li>
<li><p>color/fill the backgrounds by catchment? that’s getting fairly fancy.</p></li>
<li><p>average over something? Not sure that really makes sense? I think this might be good for now.</p></li>
<li><p>Theming: a set theme. and standard set of scenario colours that is consistent across figs, even when scenarios are filtered.</p></li>
<li><p>I think make the theme set, and the colors we allow an argument, and make the user specify those relationships if they want to.</p></li>
</ul>
</section>
</section>
<section id="setting-baseline" class="level2">
<h2 class="anchored" data-anchor-id="setting-baseline">Setting baseline</h2>
<p>We want to set a baseline and the relationship to it. The baseline should be able to be either a scenario name or a scalar. Potentially something else (e.g.&nbsp;historical daily means), but deal with that later- relatively straightforward to add a method to pass a dataframe with date and flow cols, for example.</p>
<p>Do we want to build it into the plot functions, or pre-run it? Definitely make it available for the latter, but does it just make the plot functions too messy? Would be nice for auto-labelling though.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-14_b21af7db996c6505837a7fdb1d09050d">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dif_flow <span class="ot">&lt;-</span> <span class="fu">baseline_compare</span>(scenehydros, <span class="at">compare_col =</span> <span class="st">'scenario'</span>, <span class="at">base_lev =</span> <span class="st">'base'</span>, <span class="at">values_col =</span> <span class="st">'flow'</span>, <span class="at">comp_fun =</span> difference)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-15_109349704b1bffcbdf949d44ed3e3816">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hydrographs</span>(dif_flow, <span class="at">gaugefilter =</span> gauges_to_plot, <span class="at">y_col =</span> <span class="st">'difference_flow'</span>, <span class="at">colors =</span> scene_pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Relative</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-16_6965fd1300954ca51a106d027c7e1b8b">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>rel_flow <span class="ot">&lt;-</span> <span class="fu">baseline_compare</span>(scenehydros, <span class="at">compare_col =</span> <span class="st">'scenario'</span>, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">base_lev =</span> <span class="st">'base'</span>, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">values_col =</span> <span class="st">'flow'</span>, <span class="at">comp_fun =</span> relative, <span class="at">add_eps =</span> <span class="fu">min</span>(scenehydros<span class="sc">$</span>flow[scenehydros<span class="sc">$</span>flow <span class="sc">&gt;</span> <span class="dv">0</span>])<span class="sc">/</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-17_e6a01edec82c08ba85285167a86fc9b7">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hydrographs</span>(rel_flow, <span class="at">gaugefilter =</span> gauges_to_plot, <span class="at">y_col =</span> <span class="st">'relative_flow'</span>, <span class="at">colors =</span> scene_pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Well, I guess that makes sense. The scenarios are 4x and 0.24x, and so they always are flat lines at those levels (plus the <code>add_eps</code>) unless everything is 0. It will be more relevant for other things, I think.</p>
<p>Mutliplicative will usually make more sense with a logged y</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-18_b83b92e8a71b57a80aeac0381a3549e0">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hydrographs</span>(rel_flow, <span class="at">gaugefilter =</span> gauges_to_plot, <span class="at">y_col =</span> <span class="st">"relative_flow"</span>, <span class="at">colors =</span> scene_pal, <span class="at">transy =</span> <span class="st">'log10'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code>transy = 'log'</code> works too, but <code>scales::trans</code> chooses ugly axis labels. Not that these are great, but they’re not as horrible.</p>
<p>I now have incorporated the ability to pass the comparison bit directly into the plot function. It’s likely the y-labels will need to be changed post-hoc, but that’s easy with <code>+ ylab('new label')</code>. It just ended up making more sense to label with exactly what they are, rather than all permutations of how i might want to label differences vs relatives vs.&nbsp;whatever down the track.</p>
<p>To re-do the above in one go, start with <code>scenehydros</code> directly</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-19_af2a1022ba8658a8aff036d3da191eaf">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hydrographs</span>(scenehydros, <span class="at">gaugefilter =</span> gauges_to_plot, <span class="at">y_col =</span> <span class="st">'flow'</span>, <span class="at">colors =</span> scene_pal, <span class="at">base_lev =</span> <span class="st">'base'</span>, <span class="at">comp_fun =</span> difference)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For the relative, I’m not adding an eps, but letting the zeros drop out here.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-20_6d50187d5d3f2952030a03865995c856">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hydrographs</span>(scenehydros, <span class="at">gaugefilter =</span> gauges_to_plot, <span class="at">y_col =</span> <span class="st">'flow'</span>, <span class="at">colors =</span> scene_pal, <span class="at">base_lev =</span> <span class="st">'base'</span>, <span class="at">comp_fun =</span> relative)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 135 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="describing-the-aggregation" class="level2">
<h2 class="anchored" data-anchor-id="describing-the-aggregation">Describing the aggregation</h2>
<p>These are Georgia’s tile plots and maps. Need to automate how they’re done. Will need the list-saved aggregations, as well as the aggseq and funseqs.</p>
<p>Though with the names and aggseqs as columns, I should be able to say what <em>happened</em> to the final outcome, just won’t be able to build up the plots. That’s fine, I think. Then can loop over the list if I want to show the build-up.</p>
</section>
</section>
<section id="analysis" class="level1">
<h1>Analysis</h1>
<section id="davids-heatmap" class="level2">
<h2 class="anchored" data-anchor-id="davids-heatmap">David’s heatmap</h2>
<p>We can’t do this yet- all we have is flow scaling, which is one-d.&nbsp;That’s fine, I can make a 1-d version (e.g an x with flow scaling, y with outcome, and fit a curve/kernel/line. But even then, we don’t have anywhere like enough data. So for now, I think we just geom_line() it, but put in the ability to use a kernel density or a spline or something.</p>
<p>The maps are actually really close to it too- they have y_col mapped to fill.</p>
<p>The 1-d version will end up looking at lot like some of the figures we had in the demo doc, and for good reason- that’s what they are.</p>
<p>So, develop the 1-d version</p>
</section>
<section id="scenario-vs-outcome-1d" class="level2">
<h2 class="anchored" data-anchor-id="scenario-vs-outcome-1d">Scenario vs outcome 1d</h2>
<p>This should take tibbles of some sort, arguments for the outcome and any groupings and return a ggplot. Possibly facetted.</p>
<p>Test first with just the EWR output summary</p>
<p>Assume we always have a ‘scenario’ column</p>
<p>Filtering is going to be trickier here- we can’t really use gaugefilter since we can’t assume gauges will exist.</p>
<p>At some level, should I just enforce the look with <code>make_pal</code> and <code>theme_werp_toolkit</code> at let us build plots ad-hoc? Yes, but let’s still provide some standard ones.</p>
<section id="bar" class="level3">
<h3 class="anchored" data-anchor-id="bar">Bar</h3>
<p>This really is a bit of a mess. We need to only plot a single value per x/color/fill/facet factorial. (and color and fill are unlikely to differ)</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-21_3a300df8b623e8907b54169aae3be7cc">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(summary_ewr_output, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> scenario, <span class="at">y =</span> ewr_achieved, <span class="at">fill =</span> scenario)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="co"># I think same as geom_bar(stat = 'identity')- plots the value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>That’s quite clearly NOT plotting a single value. We could aggregate (e.g.&nbsp;over gauges), or we can split. Here, what varies within scenario? <code>gauge</code>, <code>ewr_code</code> , <code>ewr_code_timing</code>, anything else?</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-22_10b084ff06cfc924a97a4477b9a84fc9">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>summary_ewr_output <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># just grab the first code_timing</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ewr_code, gauge, scenario) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ewr_code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'BF1'</span>, <span class="st">'LF1'</span>, <span class="st">"OB5"</span>) <span class="sc">&amp;</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                  gauge <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"412002"</span>, <span class="st">"412005"</span>, <span class="st">"412038"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> scenario, <span class="at">y =</span> ewr_achieved, <span class="at">fill =</span> scenario)) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span> <span class="co"># Same as geom_bar(stat = 'identity')- plots the value</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use `reformulate` to end run the rlang issues of characters</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="fu">reformulate</span>(<span class="st">'gauge'</span>,<span class="st">'ewr_code'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So, how much handholding do we want to do? I think if we want to keep data general, as little as possible. By the time we get the data arrangement sorted out, we’ll kind of end up just wrapping the ggplot call in the arguments. I guess though we still want to do the <code>plot_prep</code> for baselining and colors? I have a feeling the workflow in practice will be more like</p>
<p>dataprep –&gt; plot_prep -&gt; ggplot code -&gt; scale_color_manual + theme_werp_toolkit</p>
<p>but we can build a function, I guess.</p>
<p>If we get to the point of making <em>default</em> plots, then the dataprep can be rolled up into a default_bar function or whatever.</p>
<p>Anyway, let’s assume the data has been arranged in a reasonable way by the user. Then, we can pass in a fill, facet_row, facet_col, and call it a day with a little check that fill * row * col isn’t longer than nrows.</p>
<p>OR, is it better to settle on what the default plots should be, and then just make them in a notebook with exposed ggplot code, since that’s more readable anyway? quite possibly. We just need to be really targetted and not fill notebooks up with 100 different copy-paste variations- at that point it SHOULD be a function. But maybe don’t write those until we bash through what we want for a given case study/report whatever. IE have an ‘experiment’ notebook that manages the run and its outputs, and use the plot infrastructure functions but not all the way to full plotting functions?</p>
<p>That would still let me enforce color palettes across scenarios, for example.</p>
<p>Kind of what I’m wondering is if the answer is more aggressive editing and re-writing, rather than functions all over the place. It will depend how things progress, I think.</p>
<p>I’ll get through this plot, and then make more demos just in ggplot (e.g.&nbsp;the next couple, maps, etc). Then we can decide exactly what the functions need to do. We already have causal plot funs too.</p>
<p>One <strong>MAJOR</strong> advantage of functions is that any data changes that clean it for a given plot aren’t preserved, and so it’s way easier to keep the data clean and know what we’re working with. and if we consistently do the <em>same</em> changes, that can be its own function, e.g.&nbsp;<code>plot_prep</code></p>
<p>The above can now be created with a function</p>
<p>First, it’s the user’s responsibility to know what the data looks like. Make some</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-23_fbf5c111027c1f931b524dbaa168a415">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ewr_to_bar_data <span class="ot">&lt;-</span> summary_ewr_output <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># just grab the first code_timing</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ewr_code, gauge, scenario) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ewr_code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'BF1'</span>, <span class="st">'LF1'</span>, <span class="st">"OB5"</span>) <span class="sc">&amp;</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                  gauge <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"412002"</span>, <span class="st">"412005"</span>, <span class="st">"412038"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then plot, and feed it the scenario palette <code>scene_pal</code> . otherwise it auto-generates with <code>scico::oslo</code>.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-24_39a16015d2b314c061bdeca44d7b2485">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_outcomes</span>(ewr_to_bar_data, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y_col =</span> <span class="st">'ewr_achieved'</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">facet_row =</span> <span class="st">'gauge'</span>, </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">facet_col =</span> <span class="st">'ewr_code'</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colorset =</span> <span class="st">'scenario'</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pal_list =</span> scene_pal,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sceneorder =</span> <span class="fu">levels</span>(sceneorder))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>colors not specified per level. Trying to use the 'colors' argument as a palette
name</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Maybe not the prettiest color choices, but everything is working.</p>
<p>Do I want a file in <code>/R</code> that just establishes all the default orders and palettes? Probably. Could be a function that gets called, e.g.&nbsp;<code>set_plot_defaults_werp()</code> at the head of notebooks/scripts.</p>
</section>
<section id="same-thing-but-better-data" class="level3">
<h3 class="anchored" data-anchor-id="same-thing-but-better-data">Same thing, but better data</h3>
<p>at the other end of the spectrum, let’s look at the basin-scaled data</p>
<p>Set up the data we want to plot. There are 27 objectives. Should we just use them all? Try it.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-25_1f833f6a5eccc592699b667cb930deb6">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>basin_to_plot <span class="ot">&lt;-</span> agg_theme_space<span class="sc">$</span>mdb <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">allArith =</span> <span class="dv">4</span>, <span class="at">oneLimiting =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="co"># for readability</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Objective))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s really only one thing to facet, so should drop to <code>facet_wrap</code> instead of <code>facet_grid</code>.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-26_a6f1ead01a052d82e0616ec338c045ab">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_outcomes</span>(basin_to_plot, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">facet_wrapper =</span> <span class="st">'Objective'</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colorset =</span> <span class="st">'scenario'</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pal_list =</span> scene_pal,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sceneorder =</span> <span class="fu">levels</span>(sceneorder))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>colors not specified per level. Trying to use the 'colors' argument as a palette
name</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stacked-bar-multiple-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="stacked-bar-multiple-outcomes">Stacked bar, multiple outcomes</h3>
<p>What’s x and what’s the stack? could be ewr_code or scenario in either place. Does it matter? Maybe not?</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-27_f3f0caf25b28f02dec364316adff5105">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basin_to_plot, <span class="fu">aes</span>(<span class="at">x =</span> scenario, <span class="at">y =</span> allArith, <span class="at">fill =</span> Objective)) <span class="sc">+</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>THat’s basically it, once i sort out the color-grouping-</p>
<p>Can I group these in some way? I have some code in causal network plots that allows specifying colors by group within a col that might work really well, e/.g. make the different Fish outcomes shades of blue, veg green, etc…</p>
<p>I now have a function.</p>
<p>I can use a single color palette</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-28_1d8c0aa9b48026f6742af9cbf8c92a0a">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>basin_to_plot <span class="ot">&lt;-</span> agg_theme_space<span class="sc">$</span>mdb <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">allArith =</span> <span class="dv">4</span>, <span class="at">oneLimiting =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="co"># for readability</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Objective))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  basin_plot <span class="ot">&lt;-</span> <span class="fu">plot_outcomes</span>(basin_to_plot,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">colorset =</span> <span class="st">'Objective'</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">"scico::oslo"</span>),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>colors not specified per level. Trying to use the 'colors' argument as a palette
name</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>  basin_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels are terribly long</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  basin_plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I can specify groups and use different palettes for each</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-29_fab6a760e52911aa630c2846153bf8a4">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="ot">&lt;-</span> agg_theme_space<span class="sc">$</span>sdl_units <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">allArith =</span> <span class="dv">4</span>) <span class="co"># for readability</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a grouping variable</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  obj_sdl_to_plot <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">env_group =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(env_obj, <span class="st">'^[A-Z]+'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(env_group)) <span class="sc">|&gt;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(env_group, env_obj)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a palette list</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  grouplist <span class="ot">=</span> <span class="fu">list</span>(<span class="at">EF =</span> <span class="st">'grDevices::Purp'</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">NF =</span> <span class="st">'grDevices::Mint'</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">NV =</span> <span class="st">'grDevices::Burg'</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">OS =</span> <span class="st">'grDevices::Blues'</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">WB =</span> <span class="st">'grDevices::Peach'</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># need to facet by space sdl unit and create a group col to take multiple palettes</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>sdl_stack <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="st">'env_group'</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> grouplist,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_wrapper =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>colors not specified per level. Trying to use the 'colors' argument as a palette
name</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>sdl_stack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And I can specify that differently with <code>facet_wrap</code> and <code>facet_rows</code></p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-30_31e02d4314d7c46ef80a04e9fe794ee2">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a> sdl_plot_facrow <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="st">'env_group'</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> grouplist,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'.'</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>colors not specified per level. Trying to use the 'colors' argument as a palette
name</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a> sdl_plot_facrow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And it might actually look best to facet on the groups</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-31_f30ef7b13391f2a63159616ddbbb2833">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sdl_plot_factgroup <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="st">'env_group'</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> grouplist,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_group'</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>colors not specified per level. Trying to use the 'colors' argument as a palette
name</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sdl_plot_factgroup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is kind of a cool plot too</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-32_0d847def0159ced428b3e13f76624b9f">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>  obj_pal <span class="ot">&lt;-</span> <span class="fu">make_pal</span>(<span class="at">levels =</span> <span class="fu">unique</span>(obj_sdl_to_plot<span class="sc">$</span>env_group),</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">palette =</span> <span class="st">'scico::berlin'</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>sdl_plot_groupblock <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'scenario'</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="st">'env_group'</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color_lab =</span> <span class="st">'Environmental</span><span class="sc">\n</span><span class="st">group'</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> obj_pal,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>))</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>sdl_plot_groupblock <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="flipped-axes" class="level4">
<h4 class="anchored" data-anchor-id="flipped-axes">Flipped axes</h4>
<p>Does that actually work better with the objectives on x and scenarios as colors? Maybe coord_flipped?</p>
<p>I haven’t done a plot_prep here, so the scenarios aren’t ordered properly, but that basically works. Maybe we should fct_reorder? Not sure what the natural ordering is.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-33_f8844897b2ffbf67761f7c2f9a6f1f61">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basin_to_plot, <span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(Objective, allArith,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">.fun =</span> sum, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">.desc =</span> <span class="cn">TRUE</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> allArith, <span class="at">fill =</span> scenario)) <span class="sc">+</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scene_pal) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So, that’s one option. It might be nice to put them in groups somehow (or have that ability). ie lump by fish, veg, whatever. For some outcomes we don’t know what that looks like.</p>
<p>One option is to fct_reorder2 with a group col, another is to use the group color thing I want to do above to set color (i.e.&nbsp;the outline).</p>
<p>And we need to make those names readable, but that’s going to be a job. Just flipping coords doesn’t work. stringr::str_wrap helps, but those names just need to be shortened, and that’s a manual job.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-34_ac894e37567644544dafe637e7309802">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basin_to_plot, <span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_wrap</span>(Objective, <span class="dv">20</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  allArith,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.fun =</span> sum, </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.desc =</span> <span class="cn">TRUE</span>),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> allArith, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> scenario)) <span class="sc">+</span> </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scene_pal) <span class="sc">+</span> </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now that I have a function for the other way, hopefully I can just modify it to make this stack. Will need to swap x and fill, and pass in scene_pal instead of of the big palette list (in addition to, if I want to color the bar outlines?).</p>
<p>For the same set as the function-ed stacks above (and the same as the env_group stack above, but without the grouping. this is similar to above, but now we don’t give different palettes to the groups.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-35_7fbbba861aa7ad92e23556ded821a06c">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_x =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">levels</span>(sceneorder))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I’m really close to having a grouping aesthetic, (I can assign color), but using color on bar plots is ugly. Some sort of faint background would be better, or coloring the x-labels by group. Not worth the time now, but it’s set up to do if I can figure out how to do those things.</p>
<p>what does that look like facetted on the groups of outcomes as well? It works OK, but not as well as when the individual objectives are stacked, since each one gets its own x-tick. I hoped <code>scales = 'free_x'</code> would work to just give each one a subset, but it only does when the groupings are in facet-columns. That’s probably OK?</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-36_ed6f4b5ec68150067049c53152035a87">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>stackfacet <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_group'</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scales =</span> <span class="st">'free_x'</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_x =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">levels</span>(sceneorder)) </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>stackfacet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can (I think) dodge the bars. These are ggplot objects, so we can tweak them a bit after they come out of the main function.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-37_82d6c2a96772fce6a39632e907fb331f">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dodgefacet <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y_lab =</span> <span class="st">'Proportion Success'</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_group'</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scales =</span> <span class="st">'free_x'</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_x =</span> <span class="cn">FALSE</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">levels</span>(sceneorder),</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">position =</span> <span class="st">'dodge'</span>) </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>dodgefacet <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Environmental Objective'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="scenario-colors" class="level3">
<h3 class="anchored" data-anchor-id="scenario-colors">scenario colors</h3>
<p>Those last two also work well (better) with scenario as colors and env_obj as x</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-38_743fd327dc9c86e98ca2b4d4b4362385">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>stackfacet <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_group'</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scales =</span> <span class="st">'free_x'</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_x =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">levels</span>(sceneorder)) </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>stackfacet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can (I think) dodge the bars. These are ggplot objects, so we can tweak them a bit after they come out of the main function.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-39_32b3f3a9bb228bae948f1541e1d42010">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dodgefacet <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_group'</span>,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scales =</span> <span class="st">'free_x'</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_x =</span> <span class="cn">FALSE</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">levels</span>(sceneorder),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">position =</span> <span class="st">'dodge'</span>)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>dodgefacet <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Environmental Objective'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
</section>
<section id="lines-with-quant-x" class="level3">
<h3 class="anchored" data-anchor-id="lines-with-quant-x">Lines with quant x</h3>
<p>This is the sort of plot we might want to make for plotting the actual values that change between scenarios. In this case, we have scenarios with flow multipliers; we add those to the data with a <code>left_join</code> here, but they should be attached.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-40_8c81a8ffeefe1818f7ef84efd0a4c37b">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(scenarios)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "scenario"</code></pre>
</div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-41_6e6090f87b2e2dc85aaf1d89502428ec">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a> sdl_line <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'delta'</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>))</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a> sdl_line <span class="co"># + theme(legend.position = 'bottom')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And we can do the same sorts of things here as elsewhere- make values relative, group the colors, etc</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-42_1f084c053cab1aed73f6f7f83d380ec6">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>  sdl_line_options <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'delta'</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y_lab =</span> <span class="st">'Proportion met'</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_lab =</span> <span class="st">'Change in flow'</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">transx =</span> <span class="st">'log10'</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color_lab =</span> <span class="st">'Environmental</span><span class="sc">\n</span><span class="st">group'</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="st">'env_group'</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> obj_pal,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">base_lev =</span> <span class="st">'base'</span>,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comp_fun =</span> <span class="st">'relative'</span>,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">'env_obj'</span>, <span class="st">'polyID'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NaN and Inf introduced in `plot_prep`, likely due to division by zero.
45 values were lost.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>  sdl_line_options</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 30 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 12 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In the demo doc, Georgia had the lines as states. This should be flexible enough to do that (well, not states, necessarily, but arbitrary groups).</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-43_1b171eccbd09796680094e7e8126c143">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>  sdl_line_catchment <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'delta'</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y_lab =</span> <span class="st">'Proportion met'</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_lab =</span> <span class="st">'Change in flow'</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">transx =</span> <span class="st">'log10'</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color_lab =</span> <span class="st">'Catchment'</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">point_group =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'RColorBrewer::Dark2'</span>),</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'env_group'</span>,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">base_lev =</span> <span class="st">'base'</span>,</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comp_fun =</span> <span class="st">'difference'</span>,</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">'env_obj'</span>, <span class="st">'polyID'</span>),</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>                          <span class="at">smooth =</span> <span class="cn">FALSE</span>)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  sdl_line_catchment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And we can smooth- if we do it for unique groupings (e.g.&nbsp;same as above), we just get smooth curves, though the loess <em>really</em> hates the sample size.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-44_66c7ed9aafd9ac148afb724921e819c5">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sdl_line_catchment_smooth <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'delta'</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y_lab =</span> <span class="st">'Proportion met'</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_lab =</span> <span class="st">'Change in flow'</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">transx =</span> <span class="st">'log10'</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color_lab =</span> <span class="st">'Catchment'</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">point_group =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'RColorBrewer::Dark2'</span>),</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'env_group'</span>,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">base_lev =</span> <span class="st">'base'</span>,</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comp_fun =</span> <span class="st">'difference'</span>,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">'env_obj'</span>, <span class="st">'polyID'</span>),</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>                          <span class="at">smooth =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(<span class="fu">print</span>(sdl_line_catchment_smooth))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also use smoothing with multiple points, e.g.&nbsp;if we want to group data in some way- maybe use it to put a line through the color groups and ignore individual levels. <strong>This is dangerous</strong>- it’s an aggregation. So it’s usually better to do the aggregation explicitly, but if you’re OK with a mean aggregation within the implied groups here, it works, and shows the data points, which is nice.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-45_28af483fb22680f7d34bdc34c202e341">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>  sdl_smooth_groups <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'delta'</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y_lab =</span> <span class="st">'Proportion met'</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_lab =</span> <span class="st">'Change in flow'</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">transx =</span> <span class="st">'log10'</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color_lab =</span> <span class="st">'Environmental</span><span class="sc">\n</span><span class="st">group'</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="st">'env_group'</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> obj_pal,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">base_lev =</span> <span class="st">'base'</span>,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comp_fun =</span> <span class="st">'difference'</span>,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">'polyID'</span>),</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">smooth =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(<span class="fu">print</span>(sdl_smooth_groups))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And if we use <code>method = 'lm'</code>, we’re just taking a mean aggregation and plotting it with the data points. Jittering should help too.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-46_f4c42af6a02cf0338c2e033b5e6a572a">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>  sdl_smooth_mean <span class="ot">&lt;-</span> obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'delta'</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y_lab =</span> <span class="st">'Proportion met'</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_lab =</span> <span class="st">'Change in flow'</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">transx =</span> <span class="st">'log10'</span>,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color_lab =</span> <span class="st">'Environmental</span><span class="sc">\n</span><span class="st">group'</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="st">'env_group'</span>,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> obj_pal,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'.'</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">base_lev =</span> <span class="st">'base'</span>,</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comp_fun =</span> <span class="st">'difference'</span>,</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">'polyID'</span>),</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">smooth =</span> <span class="cn">TRUE</span>,</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>                          <span class="at">smooth_method =</span> <span class="st">'lm'</span>,</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.01</span>, <span class="at">height =</span> <span class="dv">0</span>))</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(<span class="fu">print</span>(sdl_smooth_mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="maps" class="level1">
<h1>Maps</h1>
<p>Maps are highly informative, but lose two potential data dimensions, and tend to provide quantitative information through fill. This means we often have to reduce the number of categories we look at and rely heavily on facetting.</p>
<p>We can plot both polygons and points, allowing us to plot any level of spatial aggregation. We can also plot multiple layers in the foreground and background, though at present these have fewer options than the ‘primary’ layer (e.g.&nbsp;we cannot plot data as fill in multiple polygon layers).</p>
<p>A minimal map of polygon aggregations with the basin in the background- we use <code>underlay</code> and <code>overlay</code> lists to put other layers in the background/foreground.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-47_8e337f994a50fdd88eb3f3e2454bd902">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_group <span class="sc">==</span> <span class="st">'WB'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y_lab =</span> <span class="st">'All Arithmetic Mean'</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'scenario'</span>,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="fu">list</span>(<span class="at">underlay =</span> basin, </span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">underlay_pal =</span> <span class="st">'azure'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A minimal map with gauges as the focal spatial unit</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-48_3d0263c7de907285e829cbba6b38c140">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Still with the annoying way of handling the long names</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  env_obj_points_to_plot <span class="ot">&lt;-</span> agg_theme_space<span class="sc">$</span>env_obj <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">allArith =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-49_06595c88ebc5c04bd8071d67254897c3">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>env_obj_points_to_plot <span class="sc">|&gt;</span> <span class="co"># for readability</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_obj <span class="sc">==</span> <span class="st">'NF1'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y_lab =</span> <span class="st">'All Arithmetic Mean'</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'scenario'</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="fu">list</span>(<span class="at">underlay =</span> <span class="st">'basin'</span>,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">underlay_pal =</span> <span class="st">'azure'</span>)) <span class="sc">+</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We <em>can</em> have informative fill in polygons underlying gauge data, here not with a data fill but a name fill. It is hard to find palettes for the full set of catchments. The only discrete palette available that makes sense is <code>ggsci::default_igv</code>, and it’s pretty garish. Using a continuous palette (e.g.&nbsp;<code>scico::oslo</code> ) works fine too, but the colors aren’t very well spatially-separated. We need to come up with a default set that we like, I think. Could be as simple as an actual mapping of specific colors to catchments, a la <code>scene_pal</code>.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-50_127e95e7fab76a137fe590da6a0d7a1a">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>env_obj_points_to_plot <span class="sc">|&gt;</span> <span class="co"># for readability</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_obj <span class="sc">==</span> <span class="st">'NF1'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y_lab =</span> <span class="st">'All arithmetic mean'</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'scenario'</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="fu">list</span>(<span class="at">underlay =</span> sdl_units,</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">underlay_ycol =</span> <span class="st">'SWSDLName'</span>,</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">underlay_pal =</span> <span class="st">'ggsci::default_igv'</span>)) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can use a continuous variable on the underlay fill, but have to be careful to choose palettes that don’t mask each other. We can also have multiple levels of underlay polygons (e.g.&nbsp;if we want the basin under sdl units). Note that we can pass colors directly, and not necessarily as a palette.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-51_74e4101fdfe9b323486cf3b60955cdd8">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>env_obj_points_to_plot <span class="sc">|&gt;</span> <span class="co"># for readability</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_obj <span class="sc">==</span> <span class="st">'NF1'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'ggthemes::Orange-Gold'</span>),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'scenario'</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">underlay =</span> <span class="st">'basin'</span>,</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">underlay_pal =</span> <span class="st">'cornsilk'</span>),</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">list</span>(<span class="at">underlay =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(obj_sdl_to_plot, env_obj <span class="sc">==</span> <span class="st">'NF1'</span>),</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">underlay_ycol =</span> <span class="st">'allArith'</span>,</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">underlay_pal =</span> <span class="st">'scico::oslo'</span>))) <span class="sc">+</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also overlay, here with the sdl layer as ‘primary’, here with a single color to show where gauges are.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-52_53fa5564e2443e7fb538c157649ef31e">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_obj <span class="sc">==</span> <span class="st">'NF1'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'scenario'</span>,</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="st">'basin'</span>,</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">overlay_list =</span> <span class="fu">list</span>(<span class="at">overlay =</span> <span class="st">'bom_basin_gauges'</span>,</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">overlay_pal =</span> <span class="st">'grey40'</span>,</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">clip =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also give the overlay informative colors- this outcome is similar to what we’ve done above, but the amount of control we have over scaling etc differs depending on whether a layer is ‘primary’. I intend to make this more general, but have not yet because the conditionals keep getting more complex.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-53_8c634b601f5ba3659984f8d2c0bc66d7">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_obj <span class="sc">==</span> <span class="st">'NF1'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::berlin'</span>),</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'scenario'</span>,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="st">'basin'</span>,</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">overlay_list =</span> <span class="fu">list</span>(<span class="at">overlay =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(env_obj_points_to_plot, env_obj <span class="sc">==</span> <span class="st">'NF1'</span>),</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">overlay_pal =</span> <span class="st">'scico::oslo'</span>,</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">overlay_ycol =</span> <span class="st">'allArith'</span>,</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">clip =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, we have a primary layer at the basin scale, overlay the sdl units with empty fill, and then put gauges on with informative values. There’s clearly a lot we can do here with the layering, most of which I’ve tested.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-54_df20e015ae9487a0cf98069e6dcfb6e1">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>agg_theme_space<span class="sc">$</span>mdb <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">allArith =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="co"># for readability</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Objective <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Maintain water-dependent species richness"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Increase opportunities for colonial waterbird breeding*"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Support instream &amp; floodplain productivity"</span>)) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'scico::oslo'</span>),</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'scenario'</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'Objective'</span>,</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">overlay_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">overlay =</span> <span class="st">'sdl_units'</span>, <span class="at">overlay_pal =</span> <span class="st">'black'</span>),</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">list</span>(<span class="at">overlay =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(env_obj_points_to_plot, env_obj <span class="sc">==</span> <span class="st">'NF1'</span>),</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">overlay_pal =</span> <span class="st">'ggthemes::Orange-Gold'</span>,</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">overlay_ycol =</span> <span class="st">'allArith'</span>)))<span class="sc">+</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As with the other plotting functions, we can compare to baseline using arbitrary functions, here <code>difference</code> and <code>relative</code> most likely.</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-55_637cf8ef804c555a2ac6ac9cc860cb75">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_group <span class="sc">==</span> <span class="st">'WB'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'ggthemes::Orange-Blue-White Diverging'</span>),</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'scenario'</span>,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">base_lev =</span> <span class="st">'base'</span>,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comp_fun =</span> <span class="st">'difference'</span>,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">'env_obj'</span>, <span class="st">'polyID'</span>), <span class="co"># Do I need to group_by polyID for the maps? Yes. should probably automate that.</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="fu">list</span>(<span class="at">underlay =</span> basin, <span class="at">underlay_pal =</span> <span class="st">'azure'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Relative</p>
<div class="cell" data-hash="plot_creation_cache/html/unnamed-chunk-56_40d461b9a24cbc2355e53f50f83b7fcc">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>obj_sdl_to_plot <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(env_group <span class="sc">==</span> <span class="st">'WB'</span>) <span class="sc">|&gt;</span> <span class="co"># Need to reduce dimensionality</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_outcomes</span>(<span class="at">y_col =</span> <span class="st">'allArith'</span>,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x_col =</span> <span class="st">'map'</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorgroups =</span> <span class="cn">NULL</span>,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">colorset =</span> <span class="st">'allArith'</span>,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pal_list =</span> <span class="fu">list</span>(<span class="st">'ggthemes::Orange-Blue-White Diverging'</span>),</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_col =</span> <span class="st">'env_obj'</span>,</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">facet_row =</span> <span class="st">'scenario'</span>,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scene_pal =</span> scene_pal,</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sceneorder =</span> <span class="fu">c</span>(<span class="st">'down4'</span>, <span class="st">'base'</span>, <span class="st">'up4'</span>),</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">base_lev =</span> <span class="st">'base'</span>,</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comp_fun =</span> <span class="st">'relative'</span>,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">zero_adjust =</span> <span class="st">'auto'</span>,</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">transy =</span> <span class="st">'log10'</span>,</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_cols =</span> <span class="fu">c</span>(<span class="st">'env_obj'</span>, <span class="st">'polyID'</span>), <span class="co"># Do I need to group_by polyID for the maps? Yes. should probably automate that.</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">underlay_list =</span> <span class="fu">list</span>(<span class="at">underlay =</span> basin, <span class="at">underlay_pal =</span> <span class="st">'azure'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in self$trans$transform(x): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Transformation introduced infinite values in discrete y-axis</code></pre>
</div>
<div class="cell-output-display">
<p><img src="plot_creation_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="aggsequencing" class="level1">
<h1>Aggsequencing</h1>
<p>For most plots (except hydrographs), we need a way to choose which aggsequences to plot. It needs to work for the column-format and the name-format (though I guess we could force one).</p>
<p>And we need to be able to facet on it- ie facet by aggreation in step 3.</p>
<p>How? There’s an easy bypass of just asking for the column if namehistory, and facetting by columns. (is that true that we can facet by multiple?)</p>
<p>Otherwise, I think we should be able to feed it a funsequence that may be a subset of the original one, and it’ll grab that. Then if any item in the funsequence is longer than 1, facet on it.</p>
<p>We’re going to want this all the time to choose what to plot/process. But it will be essential for the tile explanatory plots.</p>
</section>
<section id="tiles" class="level1">
<h1>Tiles</h1>
</section>
<section id="causal-networks" class="level1">
<h1>Causal networks</h1>
<p>I think I’ll bring this over during the big revamp of demo/example/templating</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Website, documentation, and toolkit work in progress. Not to be distributed outside QAEL, MDBA, CSIRO</div>   
  </div>
</footer>



</body></html>